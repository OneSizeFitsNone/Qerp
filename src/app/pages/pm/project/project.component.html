<div widget class="card" style="max-height: 100%!important;">
    <div class="card-header">
        <span class="text-uppercase">{{ "project" | translate }}: {{ project.number }}
        </span>

        <div class="widget-controls">
            <i class="fa fa-chevron-left mr-3 cursor" (click)="goBack()" data-toggle="tooltip" data-animation="false"
                data-placement="bottom" title="{{ 'general.goback' | translate }}"></i>
            <i *ngIf="project.id != 0" class="fa fa-chevron-up mr-3 cursor" data-toggle="tooltip" data-animation="false"
                data-placement="bottom" title="{{ 'general.saveitem' | translate }}" (click)="saveItem()"></i>
            <i class="fa fa-times cursor" [routerLink]="'/pages/pm/projects'" data-toggle="tooltip" data-animation="false"
                data-placement="bottom" title="{{ 'general.close' | translate }}"></i>
        </div>  

    </div>
    <div class="card-body scroll">
        <div class="row">

            <div class="col-lg-3 col-md-12 col-sm-12 bottom-30">

                <mat-tab-group dynamicHeight animationDuration="0ms" class="card border-0 box-shadow" mat-stretch-tabs="false" mat-align-tabs="start">
                    <mat-tab label="{{ 'company' | translate}}">
                        <div class="col-12">

                            <az-image-display *ngIf="project.client?.id" [appTypeId]="appTypes.client" [linkTypeId]="project.client?.id" [showEdit]="false"></az-image-display>

                            <h4 class="card-title text-center mb-4">
                                <span>
                                    <a href="javascript:void(0)" class="cursor" [routerLink]="'/pages/crm/company/'+project.client?.id">
                                        {{ project.client?.name }}
                                    </a>
                                </span>
                                <span *ngIf="project.client?.website?.length > 0">
                                    <br><small><a href="{{ project.client.website }}" target="_blank">{{ project.client.website }}</a></small>
                                </span>
                            </h4>                                                      
        
                            <div *ngIf="project.client?.address || project.client?.city" class="row mb-4">
                                <div class="col-md-2">
                                    <i class="fa fa-home"></i>
                                </div>
                                <div class="col-md-10 text-left" style="white-space: pre-wrap;">
                                    <span *ngIf="project.client.address">{{ project.client.address }}</span><br *ngIf="project.client.address && project.client.city?.name">
                                    <span *ngIf="project.client.city?.postalCode">{{ project.client.city.postalCode }}</span><span *ngIf="project.client.city?.name"> {{ project.client.city.name }}</span><br *ngIf="project.client.address && project.client.city?.name">
                                    <span *ngIf="project.client.city?.name">{{ project.client.city.province.name }}, {{ project.client.city.province.country.nicename }}</span>
                                </div>
                            </div>

                            <div *ngIf="project.client?.phone || project.client?.mobile" class="row mb-4">
                                <div class="col-md-2">
                                    <i *ngIf="project.client?.phone" class="fa fa-phone"></i><br *ngIf="project.client.phone && project.client.mobile">
                                    <i *ngIf="project.client?.mobile" class="fa fa-mobile"></i>
                                </div>
                                <div class="col-md-10 text-left">
                                    <span *ngIf="project.client?.phone">{{ project.client.phone }}</span><br *ngIf="project.client.phone && project.client.mobile">
                                    <span *ngIf="project.client?.mobile">{{ project.client.mobile }}</span>
                                </div>
                            </div>
        
                            <div *ngIf="project.client?.email" class="row mb-4">
                                <div class="col-md-2">
                                    <i class="fa fa-envelope"></i>
                                </div>
                                <div class="col-md-10 text-left">
                                    {{ project.client.email }}
                                </div>
                            </div>

                        </div>
                        
                    </mat-tab>

                    <mat-tab label="{{ 'contact' | translate}}">
                        <div class="col-12">

                            <az-image-display *ngIf="project.contact?.id" [appTypeId]="appTypes.contact" [linkTypeId]="project.contact?.id" [showEdit]="false"></az-image-display>
                            
                            <h4 class="card-title text-center mb-4">
                                <span>
                                    <a href="javascript:void(0)" class="cursor" [routerLink]="'/pages/crm/contact/'+project.contact?.id">
                                        {{ project.contact?.fullname }}
                                    </a>
                                </span>
                            </h4>                                                           
      
                            <div *ngIf="project.contact?.address || project.contact?.city" class="row mb-4">
                              <div class="col-md-2">
                                  <i class="fa fa-home"></i>
                              </div>
                              <div class="col-md-10 text-left" style="white-space: pre-wrap;">
                                  <span *ngIf="project.contact?.address">{{ project.contact?.address }}</span><br *ngIf="project.contact?.address && project.contact?.city?.name">
                                  <span *ngIf="project.contact?.city?.postalCode">{{ project.contact?.city.postalCode }}</span><span *ngIf="project.contact?.city?.name"> {{ project.contact?.city.name }}</span><br *ngIf="project.contact?.address && project.contact?.city?.name">
                                  <span *ngIf="project.contact?.city?.name">{{ project.contact?.city.province.name }}, {{ project.contact?.city.province.country.nicename }}</span>
                              </div>
                            </div>
                            
                            <div *ngIf="project.contact?.phone || project.contact?.mobile" class="row mb-4">
                              <div class="col-md-2">
                                  <i *ngIf="project.contact?.phone" class="fa fa-phone"></i><br *ngIf="project.contact?.phone && project.contact?.mobile">
                                  <i *ngIf="project.contact?.mobile" class="fa fa-mobile"></i>
                              </div>
                              <div class="col-md-10 text-left">
                                  <span *ngIf="project.contact?.phone">{{ project.contact?.phone }}</span><br *ngIf="project.contact?.phone && project.contact?.mobile">
                                  <span *ngIf="project.contact?.mobile">{{ project.contact?.mobile }}</span>
                              </div>
                            </div>
      
                            <div *ngIf="project.contact?.email" class="row mb-4">
                              <div class="col-md-2">
                                  <i class="fa fa-envelope"></i>
                              </div>
                              <div class="col-md-10 text-left">
                                  {{ project.contact?.email }}
                              </div>
                            </div>

                        </div>
                        
                    </mat-tab>
                </mat-tab-group>
            </div>

            <div class="col-lg-9 col-md-12 col-sm-12 bottom-30">
                <div class="card card-info border-0 box-shadow">
                    <div class="card-body bg-white">
                        <form [formGroup]="projectForm" class="row">

                            <div class="col-md-6">
                                <mat-form-field class="mat-field">
                                    <mat-label *ngIf="this.id != 0">{{ "project.number" | translate }}</mat-label>
                                    <mat-label *ngIf="this.id == 0">{{ "project.numberwillbeassigned" | translate }}</mat-label>
                                    <input matInput formControlName="number" [readonly]="id == 0">
                                    <mat-error *ngIf="projectForm.get('number').touched && projectForm.get('number').hasError('required')">
                                        {{ "project.number" | translate }} {{ "form.isrequired" | translate}}
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-md-6" ></div>
                            
                            <div class="col-md-6" >
                                <mat-form-field class="mat-field">
                                    <mat-label>{{ "project.type" | translate }}</mat-label>
                                    <mat-select formControlName="projectTypeId">
                                        <mat-option [value]="null"></mat-option>
                                        <mat-option *ngFor="let projectType of projectTypes" [value]="projectType.id">{{ projectType.name }}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="col-md-6" >
                                <mat-form-field class="mat-field">
                                    <mat-label>{{ "general.status" | translate }}</mat-label>
                                    <mat-select formControlName="statusId">
                                        <mat-option [value]="null"></mat-option>
                                        <mat-option *ngFor="let status of statuses" [value]="status.id">{{ status.name | translate }}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="col-md-6">
                                <mat-form-field class="mat-field">
                                    <mat-label>{{ "company" | translate }}</mat-label>
                                    <mat-select formControlName="clientId" (openedChange)="searchcompany.focus()">                                        
                                        <mat-form-field class="mat-field">
                                            <input #searchcompany matInput placeholder="{{ 'general.search' | translate }}" 
                                                (input)="onSearchCompany($event.target.value)" (keydown)="$event.stopPropagation()">
                                            <a href="javascript:void(0)" (click)="onEnterSearchClientOrContact('company')">
                                                <i *ngIf="companySearch.length > 2" class="fa fa-plus-square cursor"></i>
                                            </a>                                            
                                        </mat-form-field>
                                        <mat-option hidden [value]="null"></mat-option>
                                        <mat-option *ngFor="let company of companies" [value]="company.id">{{ company.name }}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            
                            <div class="col-md-6">
                                <mat-form-field class="mat-field">
                                    <mat-label>{{ "contact" | translate }}</mat-label>
                                    <mat-select formControlName="contactId" (openedChange)="searchcontact.focus()">                                        
                                        <mat-form-field class="mat-field">
                                            <input #searchcontact matInput placeholder="{{ 'general.search' | translate }}" 
                                                (input)="onSearchContact($event.target.value)" (keydown)="$event.stopPropagation()">
                                            <a href="javascript:void(0)" (click)="onEnterSearchClientOrContact('contact')">
                                                <i *ngIf="contactSearch.length > 2" class="fa fa-plus-square cursor"></i>
                                            </a>                                            
                                        </mat-form-field>
                                        <mat-option [value]="null" hidden></mat-option>
                                        <mat-option *ngFor="let contact of contacts" [value]="contact.id">{{ contact.fullname }}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="col-md-6">
                                <mat-form-field class="mat-field">
                                    <mat-label>{{ "general.deadline" | translate }}</mat-label>
                                    <input matInput [matDatepicker]="deadlinePicker" formControlName="deadline">
                                    <mat-datepicker-toggle matSuffix [for]="deadlinePicker"></mat-datepicker-toggle>
                                    <mat-datepicker [twelveHour]="false" type="datetime" #deadlinePicker></mat-datepicker>
                                </mat-form-field>
                            </div>                           

                            <div class="col-md-6">
                                <mat-form-field class="mat-field">
                                    <mat-label>{{ "project.estimatedBudget" | translate }}</mat-label>
                                    <input matInput type="number" formControlName="estimatedBudget">
                                </mat-form-field>
                            </div> 

                            <div class="col-md-12">
                                <mat-form-field class="mat-field">
                                    <mat-label>{{ "general.description" | translate }}</mat-label>
                                    <textarea matInput formControlName="description" rows="5"></textarea>
                                </mat-form-field>
                            </div>

                            <div class="form-group col-12 pt-3 text-right">
                                <button *ngIf="id > 0" [disabled]="!projectForm.dirty" class="btn btn-success cursor" (click)="undoChanges()">{{ "form.undoChanges" | translate }}</button>&nbsp;<button [disabled]="!projectForm.valid" class="btn btn-success cursor" (click)="onSubmit()">{{ "form.save" | translate }}</button>
                            </div>

                        </form>
                        
                    </div>
                </div>
            </div>
        </div>

        <mat-tab-group *ngIf="project.id > 0" (selectedIndexChange)="onTabIndexChange($event)" dynamicHeight animationDuration="0ms" class="card border-0 box-shadow" mat-stretch-tabs="false" mat-align-tabs="start">
            
            <mat-tab label="{{ 'contacts' | translate}}">
                <div class="col-md-12 mt-3">
                    <az-apptypecontacts *ngIf="tabIndex == 0" [appTypeId]="appTypes.project" [linkTypeId]="project.id" ></az-apptypecontacts>
                </div>
                
            </mat-tab>
            <mat-tab label="{{ 'milestones' | translate}}">
                <div class="col-md-12 mt-3">
                    <az-milestones-tab *ngIf="tabIndex == 1" [appTypeId]="appTypes.project" [linkTypeId]="project.id" [parent]="project"></az-milestones-tab>
                </div>
            </mat-tab>

            <mat-tab label="{{ 'tasks' | translate}}">
                <div class="col-md-12 mt-3">
                    <az-tasks-tab *ngIf="tabIndex == 2" [appTypeId]="appTypes.project" [linkTypeId]="project.id" [parent]="project"></az-tasks-tab>
                </div>
            </mat-tab>
        </mat-tab-group>
        

    </div>
</div>